[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[supervisord]
nodaemon=true
logfile=/home/golem/logs/supervisord.log
pidfile=/home/golem/supervisord.pid

[program:xvfb]
command=Xvfb :0 -screen 0 %(ENV_RESOLUTION)sx24
autorestart=true
priority=100

[program:windowmanager]
command=%(ENV_WM_COMMAND)s
autorestart=true
priority=200
environment=DISPLAY=":0"

[program:setup_wizard]
# Only runs if script exists (Desktop version)
command=/bin/bash -c "if [ -f /home/golem/scripts/setup_wizard.sh ]; then /home/golem/scripts/setup_wizard.sh; fi"
autorestart=false
priority=250
environment=DISPLAY=":0"

[program:chromium]
command=/home/golem/scripts/start_chromium.sh
autorestart=true
priority=300
environment=DISPLAY=":0"

[program:fileserver]
# This creates the direct download link for ComfyUI
command=python3 -m http.server 8000 --directory /workspace
autorestart=true
priority=600

[program:x11vnc]
command=/bin/bash -c "while ! xdpyinfo -display :0 >/dev/null 2>&1; do sleep 0.1; done; exec x11vnc -display :0 -forever -shared %(ENV_VNC_AUTH_FLAG)s"
autorestart=true
priority=400

[program:novnc]
command=/usr/share/novnc/utils/novnc_proxy --vnc localhost:5900 --listen 6080
autorestart=true
priority=500
